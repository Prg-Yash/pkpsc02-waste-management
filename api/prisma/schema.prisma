// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
  output   = "./generated/prisma"
}

enum WasteStatus {
  PENDING
  IN_PROGRESS
  COLLECTED
}

enum NotificationType {
  WASTE_REPORTED
  WASTE_COLLECTED
  COLLECTOR_ENABLED
}

model User {
  id              String  @id
  email           String  @unique
  name            String?
  phone           String?
  enableCollector Boolean @default(false)

  city    String?
  state   String?
  country String?

  reporterPoints  Int @default(0)
  collectorPoints Int @default(0)
  globalPoints    Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  reportedWastes    WasteReport[]  @relation("UserReportedWastes")
  collectedWastes   WasteReport[]  @relation("UserCollectedWastes")
  routePlannerWaste WasteReport[]  @relation("RoutePlannerCollector")
  notifications     Notification[]

  @@index([globalPoints, reporterPoints, collectorPoints])
}

model WasteReport {
  id String @id @default(cuid())

  reporterId String
  reporter   User   @relation("UserReportedWastes", fields: [reporterId], references: [id])

  collectorId String?
  collector   User?   @relation("UserCollectedWastes", fields: [collectorId], references: [id])

  routeCollectorId String?
  routeCollector   User?   @relation("RoutePlannerCollector", fields: [routeCollectorId], references: [id])

  imageUrl          String
  collectorImageUrl String?

  locationRaw      String
  isLocationLatLng Boolean @default(false)
  latitude         Float?
  longitude        Float?
  city             String?
  state            String?
  country          String?

  // AI Analysis Data (JSON format)
  // Contains: wasteType, confidence, estimatedWeightKg, notes, category
  // + category-specific fields (segregation, recyclability, etc.)
  aiAnalysis Json?

  status WasteStatus @default(PENDING)

  reportedAt  DateTime  @default(now())
  collectedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Notification {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  type  NotificationType
  title String
  body  String
  data  Json?
  read  Boolean          @default(false)

  createdAt DateTime @default(now())
}
